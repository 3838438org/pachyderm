{
  "pipeline": {
    "name": "wordcount_input"
  },
  "transform": {
    "image": "derekchiang/job-shim:latest",
    "cmd": ["sh"],
    "stdin": [
        "wget ftp://ftp.ecn.purdue.edu/puma/wikipedia_50GB.tar.bz2 && tar xvjf wikipedia_50GB.tar.bz2 -C /pfs/out --strip-components=1"
    ],
    "debug": true
  },
  "parallelism": "1"
}
{
  "pipeline": {
    "name": "wordcount_map"
  },
  "transform": {
    "image": "derekchiang/wordcount-map:latest",
    "cmd": ["/map", "/pfs/wordcount_input", "/pfs/out"],
    "debug": true
  },
  "inputs": [
    {
      "repo": {
        "name": "wordcount_input"
      }
    }
  ]
}
{
  "pipeline": {
    "name": "wordcount_reduce"
  },
  "transform": {
    "image": "derekchiang/job-shim:latest",
    "cmd": ["sh"],
    "stdin": [
        "find /pfs/wordcount_map/* | while read count; do cat $count | awk '{ sum+=$1} END {print sum}' >/tmp/count; mv /tmp/count /pfs/out/`basename $count`; done"
    ],
    "debug": true
  },
  "inputs": [
    {
      "repo": {
        "name": "wordcount_map"
      },
	  "method": "reduce"
    }
  ]
}
